## 远震双平面波前期数据处理步骤

说明：此次关于青藏高原东南缘壳幔结构的研究区域为20-32，96-108，区域中心点设置为(26，102)，数据格式为mseed

#### 1. 事件筛选：

合适的事件需满足：

距研究区域中心点的震中距范围要在30-120之间，震级大于5.5级，一个地震事件前后三个小时没有其他的地震事件

#### 2. 格式转换

将已有的MSEED格式的数据转换成SAC格式

#### 3. 重采样

将100Hz采样率的数据重采样至5Hz

#### 4.去仪器响应
 
有些台站可能中间更换过仪器类型，需要多加注意。
在这一步操作注意要更改SAC的文件名以保留原始数据备份，比如原始的SAC文件为*.SAC，去仪器响应之后的命名为*.SAC_RMRESP

#### 5.添加事件和台站信息

MSEED格式的数据只有地震数据本身，头段变量基本没有，都要自行添加

#### 6.滤波到目标频段

在这一步可以进行对数据进行截取，进一步减小数据量，取发震时刻到发震后5400s这一时窗即可。

数据的组织形式是每个事件为一个文件夹，里面存放有所有台站不同主频的数据，每个频带的数据都要保留

1. 143: 0.005-0.009
2. 125: 0.006-0.010
3. 111:  0.007-0.011
4. 100: 0.008-0.012
5. 091: 0.008-0.014
6. 077: 0.007-0.017
7. 067: 0.010-0.020
8. 059: 0.012-0.022
9. 050: 0.015-0.025
10. 045: 0.017-0.027
11. 040: 0.020-0.030
12. 033: 0.025-0.035
13. 029: 0.030-0.040
14. 025: 0.035-0.045
15. 022: 0.040-0.050
16. 020: 0.045-0.055
17. 018: 0.050 -0.060
18. 017: 0.055-0.065

#### 7.筛选好的事件

通过计算面波窗口的信噪比，整体信噪比大于5的台站记录才可以得到保留。

关于信噪比的计算，目前的大致实现思路是：对于每道台站记录，先确定这段记录内最大振幅出现的时刻`A_Tmax`，并将此最大振幅`S`作为信号强度。

之后计算整段记录的均方根`N`，作为噪声强度，`S/N`作为信噪比。除此之外，还需要求一个事件一个主频内所有台站记录最大振幅出现时刻的平均值`T_ave`，

如果abs(A_Tmax-T_ave) < 500s && SNR > 5，就认为这是一个好的事件。并将信噪比与A_Tmax分别写入头段user5，user6用于脚本筛选

#### 8.手动标定每个频带面波的起始时刻

在这里需要确定一个事件不同主频中，震中距最小的台站面波到时ntb，和震中距最大台站的面波到时ftb，以及该主频面波的长度length

关于选取的标准：面波起始应尽可能靠近主信号，以避免多次S波的干扰，终点应尽可能选择面波衰减到0处，这两者之差作为length

这样对于单一主频剩下所有的台站来说，可以使用线性插值的方法确定其余所有台站的面波到时，并写入头段t2

关于线性插值：通过震中距最小的台站震中距ndist，与震中距最大的台站fdist，加上ntb与ftb可以计算出一条D-T直线，将每道记录的震中距带入得到对应道的面波起始

这一步最为耗时，挑数据一天不宜进行太多，容易心态爆炸

length_dict = {'017':1000,
               '018':1000,
               '020':800,
               '022':800,
               '025':800,
               '029':700,
               '033':700,
               '040':600,
               '045':450,
               '050':300,
               '059':300,
               '067':300,
               '077':330,
               '091':400,
               '100':450,
               '111':500,
               '125':550,
               '143':600}
               
#### 9.截取数据，taper，补零

有了每道面波的起始时刻t2之后，将面波单独截取出来，首尾各多出的50s用于taper(平滑衰减到0）

截取起始时刻：t2-50

截取终止时刻：t2+length+50

taper

关于补零：

对于一个event来说，每个台站每个主频补零的起始点和终点都要保持一致，由于面波低频速度更快的特性，

起始点应该标记为震中距最小的台站143s面波的起始，终止点应该标记为震中距最大的台站017s面波的终止

都可以适当调整，经过补零之后的数据长度应为2000s

### 至此，数据预处理完成

